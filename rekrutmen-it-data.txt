-- Test 1 --
SELECT 
    CASE 
        WHEN a.nama LIKE '%Cabang Koordinator%' THEN a.nama
        ELSE a.nama
    END AS cabkor,
    
    CASE 
        WHEN a.nama LIKE '%Cabang%' AND a.nama NOT LIKE '%Cabang Koordinator%' THEN a.nama
        ELSE a.nama
    END AS cabang,
    
    CASE 
        WHEN a.nama LIKE '%Cabang Pembantu%' THEN a.nama
        ELSE a.nama
    END AS unit_kerja
FROM `rekrutmenitdata.data_cabang` a;

-- Test 2 --
SELECT 
    IdNasabah, 
    KodeCabang, 
    NamaNasabah, 
    TanggalLahir, 
    CASE 
        WHEN SAFE.PARSE_DATE('%Y%m%d', CAST(TanggalLahir AS STRING)) IS NULL THEN 'False'
        WHEN EXTRACT(DAY FROM SAFE.PARSE_DATE('%Y%m%d', CAST(TanggalLahir AS STRING))) > 31 THEN 'False'
        WHEN EXTRACT(MONTH FROM SAFE.PARSE_DATE('%Y%m%d', CAST(TanggalLahir AS STRING))) = 2
             AND EXTRACT(DAY FROM SAFE.PARSE_DATE('%Y%m%d', CAST(TanggalLahir AS STRING))) > 29 THEN 'False'
        WHEN EXTRACT(MONTH FROM SAFE.PARSE_DATE('%Y%m%d', CAST(TanggalLahir AS STRING))) IN (4, 6, 9, 11)
             AND EXTRACT(DAY FROM SAFE.PARSE_DATE('%Y%m%d', CAST(TanggalLahir AS STRING))) > 30 THEN 'False'
        ELSE 'True'
    END AS CekTanggal
FROM `rekrutmenitdata.data_nasabah`;

-- Test 3 --
SELECT 
    Pekerjaan,
    CASE
        WHEN SAFE.PARSE_DATE('%Y%m%d', CAST(TanggalLahir AS STRING)) IS NULL THEN 1
        WHEN EXTRACT(YEAR FROM CURRENT_DATE()) - EXTRACT(YEAR FROM SAFE.PARSE_DATE('%Y%m%d', CAST(TanggalLahir AS STRING))) <= 14 THEN 1  -- (age <= 14)
        WHEN EXTRACT(YEAR FROM CURRENT_DATE()) - EXTRACT(YEAR FROM SAFE.PARSE_DATE('%Y%m%d', CAST(TanggalLahir AS STRING))) BETWEEN 15 AND 19 THEN 2  -- (15-19)
        WHEN EXTRACT(YEAR FROM CURRENT_DATE()) - EXTRACT(YEAR FROM SAFE.PARSE_DATE('%Y%m%d', CAST(TanggalLahir AS STRING))) BETWEEN 20 AND 24 THEN 3  -- (20-24)
        WHEN EXTRACT(YEAR FROM CURRENT_DATE()) - EXTRACT(YEAR FROM SAFE.PARSE_DATE('%Y%m%d', CAST(TanggalLahir AS STRING))) BETWEEN 25 AND 29 THEN 4  -- (25-29)
        WHEN EXTRACT(YEAR FROM CURRENT_DATE()) - EXTRACT(YEAR FROM SAFE.PARSE_DATE('%Y%m%d', CAST(TanggalLahir AS STRING))) BETWEEN 30 AND 34 THEN 5  -- (30-34)
        WHEN EXTRACT(YEAR FROM CURRENT_DATE()) - EXTRACT(YEAR FROM SAFE.PARSE_DATE('%Y%m%d', CAST(TanggalLahir AS STRING))) BETWEEN 35 AND 39 THEN 6  -- (35-39)
        WHEN EXTRACT(YEAR FROM CURRENT_DATE()) - EXTRACT(YEAR FROM SAFE.PARSE_DATE('%Y%m%d', CAST(TanggalLahir AS STRING))) BETWEEN 40 AND 44 THEN 7  -- (40-44)
        WHEN EXTRACT(YEAR FROM CURRENT_DATE()) - EXTRACT(YEAR FROM SAFE.PARSE_DATE('%Y%m%d', CAST(TanggalLahir AS STRING))) BETWEEN 45 AND 49 THEN 8  -- (45-49)
        WHEN EXTRACT(YEAR FROM CURRENT_DATE()) - EXTRACT(YEAR FROM SAFE.PARSE_DATE('%Y%m%d', CAST(TanggalLahir AS STRING))) BETWEEN 50 AND 54 THEN 9  -- (50-54)
        WHEN EXTRACT(YEAR FROM CURRENT_DATE()) - EXTRACT(YEAR FROM SAFE.PARSE_DATE('%Y%m%d', CAST(TanggalLahir AS STRING))) BETWEEN 55 AND 59 THEN 10  -- (55-59)
        WHEN EXTRACT(YEAR FROM CURRENT_DATE()) - EXTRACT(YEAR FROM SAFE.PARSE_DATE('%Y%m%d', CAST(TanggalLahir AS STRING))) >= 60 THEN 11  -- (60+)
    END AS KelompokUsia,
    
    COUNT(*) AS Total
FROM `rekrutmenitdata.data_nasabah`
GROUP BY Pekerjaan, KelompokUsia
ORDER BY Pekerjaan, KelompokUsia;
